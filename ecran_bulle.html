<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Bulle de Silence</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; height: 100vh; background: #0f172a; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: 'Inter', sans-serif; }

        /* LA BULLE */
        .bubble-container { position: relative; width: 400px; height: 400px; display: flex; align-items: center; justify-content: center; filter: drop-shadow(0 0 40px rgba(56, 189, 248, 0.3)); transition: filter 0.3s; }
        
        .bubble {
            width: 300px; height: 300px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.1) 20%, #38bdf8 60%, #0ea5e9 100%);
            box-shadow: inset 0 0 50px rgba(255,255,255,0.5), 0 0 20px rgba(56, 189, 248, 0.5);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative; z-index: 10;
        }

        /* Message d'√©tat */
        .status-text {
            margin-top: 50px; font-size: 2rem; font-weight: 700; letter-spacing: 5px; text-transform: uppercase;
            color: #38bdf8; opacity: 0.8; transition: color 0.3s; text-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        /* --- √âTATS --- */

        /* 1. CALME (Bleu) */
        .state-calm .bubble {
            animation: float 6s ease-in-out infinite;
            transform: scale(1); background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0.1) 20%, #38bdf8 60%, #0ea5e9 100%);
        }
        .state-calm .bubble-container { filter: drop-shadow(0 0 40px rgba(56, 189, 248, 0.3)); }
        .state-calm .status-text { color: #38bdf8; content: "SILENCE"; }

        /* 2. ATTENTION (Orange) */
        .state-warn .bubble {
            animation: shake 0.5s infinite;
            transform: scale(1.1);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.1) 20%, #f59e0b 60%, #d97706 100%);
        }
        .state-warn .bubble-container { filter: drop-shadow(0 0 60px rgba(245, 158, 11, 0.5)); }
        .state-warn .status-text { color: #f59e0b; }

        /* 3. DANGER (Rouge) */
        .state-danger .bubble {
            animation: wobble 0.1s infinite;
            transform: scale(1.3);
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9), rgba(255,255,255,0.1) 20%, #ef4444 60%, #b91c1c 100%);
        }
        .state-danger .bubble-container { filter: drop-shadow(0 0 80px rgba(239, 68, 68, 0.8)); }
        .state-danger .status-text { color: #ef4444; }

        /* ANIMATIONS */
        @keyframes float { 0%, 100% { transform: translateY(0) scale(1); border-radius: 50%; } 50% { transform: translateY(-20px) scale(1.02); border-radius: 48% 52% 50% 50%; } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg) scale(1.1); border-radius: 50%; } 25% { transform: translate(-1px, -2px) rotate(-1deg) scale(1.12); border-radius: 45% 55% 40% 60%; } 50% { transform: translate(-3px, 0px) rotate(1deg) scale(1.08); border-radius: 55% 45% 60% 40%; } 75% { transform: translate(3px, 2px) rotate(0deg) scale(1.12); } 100% { transform: translate(1px, -1px) rotate(-1deg) scale(1.1); } }
        @keyframes wobble { 0% { transform: scale(1.3) skew(0deg); } 25% { transform: scale(1.35) skew(5deg); } 50% { transform: scale(1.3) skew(0deg); } 75% { transform: scale(1.35) skew(-5deg); } 100% { transform: scale(1.3) skew(0deg); } }

        /* CONTROLS (Cach√©s en bas) */
        .controls { position: fixed; bottom: 10px; right: 10px; opacity: 0.1; transition: opacity 0.3s; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; color: white; display: flex; gap: 10px; font-size: 0.8rem; }
        .controls:hover { opacity: 1; }
    </style>
</head>
<body class="state-calm">

    <div class="bubble-container">
        <div class="bubble"></div>
    </div>
    <div class="status-text" id="status-label">CALME</div>

    <div class="controls">
        <label>Sensibilit√© Micro :</label>
        <input type="range" id="sensitivity" min="1" max="100" value="50">
        <button onclick="startListening()">üé§ ACTIVER MICRO</button>
    </div>

    <script>
        let audioContext;
        let analyser;
        let microphone;
        let isListening = false;

        async function startListening() {
            if (isListening) return;
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                analyser.fftSize = 256;
                isListening = true;
                visualize();
            } catch (err) {
                alert("Erreur Micro : V√©rifiez que vous avez autoris√© l'acc√®s.");
            }
        }

        function visualize() {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            function update() {
                requestAnimationFrame(update);
                analyser.getByteFrequencyData(dataArray);

                // Calcul du volume moyen
                let sum = 0;
                for(let i = 0; i < bufferLength; i++) {
                    sum += dataArray[i];
                }
                let average = sum / bufferLength;

                // Facteur de sensibilit√© (inverse du slider : 100 = tr√®s sensible, 1 = peu sensible)
                const sensSlider = document.getElementById('sensitivity').value;
                const sensitivity = (105 - sensSlider) / 2; 

                // Logique des √©tats
                const body = document.body;
                const label = document.getElementById('status-label');

                if (average > sensitivity * 2.5) {
                    body.className = 'state-danger';
                    label.innerText = "TROP DE BRUIT !";
                } else if (average > sensitivity) {
                    body.className = 'state-warn';
                    label.innerText = "ATTENTION...";
                } else {
                    body.className = 'state-calm';
                    label.innerText = "CALME";
                }
            }
            update();
        }

        // D√©marrage auto au clic si besoin
        document.body.addEventListener('click', () => {
            if(!isListening) startListening();
        });
    </script>
</body>
</html>